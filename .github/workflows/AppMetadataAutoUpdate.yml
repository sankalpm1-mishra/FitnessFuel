name: AppMetadataAutoUpdate

on:
  push:
    paths:
      - 'metadata/metadata.json'

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Configure Microsoft Store CLI
        uses: microsoft/microsoft-store-apppublisher@v1.1

      - name: Reconfigure store credentials
        run: msstore reconfigure `
              --tenantId ${{ secrets.AZURE_AD_TENANT_ID }} `
              --sellerId ${{ secrets.SELLER_ID }} `
              --clientId ${{ secrets.AZURE_AD_APPLICATION_CLIENT_ID }} `
              --clientSecret ${{ secrets.AZURE_AD_APPLICATION_SECRET }}

      - name: Update metadata
        run: msstore submission updateMetadata <Store product Id> '${{ github.workspace }}/metadata/metadata.json' 
      - name: Publish to Store
        run: msstore submission publish <Store product Id>
